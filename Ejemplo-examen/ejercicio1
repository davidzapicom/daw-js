<!DOCTYPE html>
<html>

<head>
    <title></title>

</head>

<body>

    <h1>Tienda</h1>
    <table>
        <thead>
            <tr>
                <th>Producto</th>
                <th>Talla</th>
                <th>Precio</th>
                <th>Cantidad</th>
            </tr>
        </thead>

        <tbody id="tab"></tbody>
    </table>

    <script type="text/javascript">
        class tienda {
            constructor(producto, talla, precio, unidades) {
                this.producto = producto;
                this.talla = talla;
                this.precio = precio;
                this.unidades = unidades;
            }
        }

        class ventas {
            constructor(prodVendido, numUnidades, precioTotal) {
                this.prodVendido = prodVendido;
                this.numUnidades = numUnidades;
                this.precioTotal = precioTotal;
            }

            calcularIva() {
                var precioConIva = this.precioTotal;
                if (this.numUnidades > 1) {
                    precioConIva = precioConIva * this.numUnidades;
                }
                var iva = precioConIva * 0.21;
                precioConIva = precioConIva + iva;
                return precioConIva;
            }
        }

        var prendas = [];

        var item1 = new tienda('camisa', 'XL', 30, 5);
        var item2 = new tienda('camisa', 'S', 30, 8);
        var item3 = new tienda('camisa', 'M', 30, 3);
        var item4 = new tienda('pantalon', 'XXL', 50, 10);
        var item5 = new tienda('pantalon', 'M', 50, 5);
        var item6 = new tienda('falda', 'L', 20, 4);
        var item7 = new tienda('falda', 'S', 20, 6);
        var item8 = new tienda('bufanda', 'XL', 15, 15);
        var item9 = new tienda('pareo', 'XL', 25, 5);


        prendas.push(item1);
        prendas.push(item2);
        prendas.push(item3);
        prendas.push(item4);
        prendas.push(item5);
        prendas.push(item6);
        prendas.push(item7);
        prendas.push(item8);
        prendas.push(item9);

        function tabla() {
            document.getElementById("tab").innerHTML = "";

            for (var i = 0; i < prendas.length; i++) {
                document.getElementById("tab").innerHTML +=`<tr><td>${prendas[i].producto}
                                                            </td><td>${prendas[i].talla}
                                                            </td><td>${prendas[i].precio}€
                                                            </td><td>${prendas[i].unidades}</td><td>
                                                            <button value="${i}" onclick="comprar(this.value)" name="compra">Comprar</button></td></tr>`;
            }
        }
        tabla();

        function comprar(o) {

            var i = parseInt(o);

            if (prendas[i].unidades == 0) {

                alert("No quedan prendas de este tipo");

            } else {

                var cantidad = parseInt(prompt("Cuántas unidades quieres?"));

                if (cantidad > prendas[i].unidades) {

                    alert("No hay tantas unidades");

                } else {

                    if (cantidad < 1) {
                        alert("Cantidad inválida");
                    } else {
                        prendas[i].unidades = prendas[i].unidades - cantidad;
                        alert("Quedan " + prendas[i].unidades + " unidades disponibles.");
                        var venta = new ventas(prendas[i].producto, cantidad, prendas[i].precio);
                        var iva = venta.calcularIva();
                        alert("El precio total por la compra es: " + iva + "€");

                        tabla();
                    }

                }

            }
        }
    </script>
</body>


</html>
